<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/loginlayout}">

<th:block layout:fragment="script">
	<script type="text/javascript">

		function loginActive() {

			var $userid = $("#userid");
			var $password = $("#password");

			if ($userid.val().trim() === '') {
				alert("아이디를 입력하세요.");
				$userid.trigger('focus');
				return false;
			}
			if ($password.val().trim() === '') {
				alert("비밀번호을 입력하세요.");
				$password.trigger('focus');
				return false;
			}

			var params = {
				userid : $userid.val(),
				password : $password.val()
			};

			const jsonString = JSON.stringify(params);

			console.log("로그인 실행");
			const url = "http://"+$("#security_url").val() + "/auth/login";
			$.ajax({
				url: url,
				type: 'post',
				data: jsonString,
				contentType: 'application/json',
				cache: false,
				error: function () {
					console.log("로그인 에러");
					alertCaution("아이디 또는 비밀번호를 확인해주세요.",1);
				},
				success: function (res) {
					console.log("로그인 되었습니다.");

					console.log("accessToken : "+res.data.token.accessToken)
					console.log("refreshToken : "+res.data.token.refreshToken)
					console.log("insert_id : "+res.data.token.insert_id)

					// setCookie(변수이름, 변수값, 유효시간);
					setCookie("JwtAccessToken",res.data.token.accessToken, 1); // 발행시간은 30분으로설정
					setCookie("JwtRefreshAccessToken", res.data.token.accessToken, 2); // 발행시간은 60분으로설정
					setCookie("JwtRefreshToken",res.data.token.refreshToken, 2); // 발행시간은 60분으로설정
					setCookie("insert_id",res.data.token.insert_id, 2); // 발행시간은 60분으로설정

					location.href="/index"
				}
			});
		}

		// function mps_Add_test(){
		// 	var settings = {
		// 		"url": "http://ec2-3-37-19-235.ap-northeast-2.compute.amazonaws.com:9910/add_Test/add",
		// 		"method": "POST",
		// 		"timeout": 0,
		// 		"headers": {
		// 			"Content-Type": "application/json"
		// 		},
		// 		"data": JSON.stringify(
		// 				{
		// 					"nargout":1,
		// 					"rhs":[1.1,2.1]
		// 				}
		// 		),
		// 	};
		//
		// 	$.ajax(settings).done(function (response) {
		// 		console.log(response);
		// 	});
		// }

	</script>
</th:block>

<div layout:fragment="content" class="login-wrap">
	<input type="hidden" id="security_url" th:value="${security_url}" />
	<div class="login">
		<h1 class="login__logo">
			<a href="/login" class="logo">
				<span>LTDAP Login</span>
			</a>
		</h1>
		<div class="login__form-box">
				<div>
					<label><input type="text" class="login__input"  id="userid" name="userid" placeholder="아이디를 입력하세요." required ></label>
				</div>
				<div>
					<label><input type="password" class="login__input" id="password" name="password" placeholder="패스워드를 입력하세요." required></label>
				</div>
				<div><input class="login__btn" value="로그인" onclick="loginActive()" /></div>
		</div>
	</div>

<!--	<h2 class="form-signin-heading"> 인프라 로그인 </h2>-->
<!--	<p>-->
<!--		<label for="userid" class="sr-only">아이디 : </label>-->
<!--		<input type="text" id="userid" name="userid" class="form-control" placeholder="아이디를 입력하세요." required="" autofocus="">-->
<!--	</p>-->
<!--	<p>-->
<!--		<label for="password" class="sr-only">비밀번호 : </label>-->
<!--		<input type="password" id="password" name="password" class="form-control" placeholder="비밀번호를 입력하세요." required="">-->
<!--	</p>-->
<!--	<button class="btn btn-lg btn-primary btn-block" onclick="loginActive()" >로그인</button>-->

<!--	<button class="btn btn-lg btn-primary btn-block" onclick="accessTokenCookieGet()" >쿠키가져오기</button>-->
<!--	<button class="btn btn-lg btn-primary btn-block" onclick="mps_Add_test()" >MPS더하기 테스트</button>-->
<!--	<button class="btn btn-lg btn-primary btn-block" onclick="yaml_test()" >YAML 파일 받아오기</button>-->
</div>

<div id='alertpop'>
</div>

</html>